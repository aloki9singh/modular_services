{"version":3,"sources":["../../src/configs/passport.ts"],"sourcesContent":["// import AdminUserModel from '@models/admin';\r\nimport { PassportStatic } from 'passport';\r\nimport bcrypt from 'bcrypt';\r\nimport { Strategy as LocalStrategy } from 'passport-local';\r\nimport UserModel from '../models/user.model';\r\nimport { UserDocument } from '../interfaces/user';\r\n\r\nexport default function (passport: PassportStatic) {\r\n\tpassport.use(\r\n\t\tnew LocalStrategy({ usernameField: 'email' }, async (email, password, done) => {\r\n\t\t\tconst user: any = await UserModel.findOne({ email: email });\r\n\t\t\tif (!user) {\r\n\t\t\t\treturn done('Email not found', false);\r\n\t\t\t}\r\n\t\t\t//match password\r\n\t\t\tif (bcrypt.compareSync(password, user.password) === false) {\r\n\t\t\t\treturn done(`Email or password is incorrect: ${password}`, false);\r\n\t\t\t}\r\n\t\t\treturn done(null, user);\r\n\t\t}),\r\n\t);\r\n\r\n\tpassport.serializeUser(function (user: UserDocument, done) {\r\n\t\treturn done(null, user._id);\r\n\t});\r\n\r\n\tpassport.deserializeUser(async function (id: string, done) {\r\n\t\ttry {\r\n\t\t\tconst user = await UserModel.findOne({ _id: id });\r\n\t\t\treturn done(null, user);\r\n\t\t} catch (err) {\r\n\t\t\treturn done(err, false);\r\n\t\t}\r\n\t});\r\n}\r\n"],"names":["passport","use","LocalStrategy","usernameField","email","password","done","user","UserModel","findOne","bcrypt","compareSync","serializeUser","_id","deserializeUser","id","err"],"mappings":";;;;+BAOA;;;eAAA;;;iDALmB;+BACuB;oDACpB;;;;;;AAGP,SAAf,SAAyBA,QAAwB;IAChDA,SAASC,GAAG,CACX,IAAIC,uBAAa,CAAC;QAAEC,eAAe;IAAQ,GAAG,OAAOC,OAAOC,UAAUC;QACrE,MAAMC,OAAY,MAAMC,kBAAS,CAACC,OAAO,CAAC;YAAEL,OAAOA;QAAM;QACzD,IAAI,CAACG,MAAM;YACV,OAAOD,KAAK,mBAAmB;QAChC;QAEA,IAAII,eAAM,CAACC,WAAW,CAACN,UAAUE,KAAKF,QAAQ,MAAM,OAAO;YAC1D,OAAOC,KAAK,CAAC,gCAAgC,EAAED,SAAS,CAAC,EAAE;QAC5D;QACA,OAAOC,KAAK,MAAMC;IACnB;IAGDP,SAASY,aAAa,CAAC,SAAUL,IAAkB,EAAED,IAAI;QACxD,OAAOA,KAAK,MAAMC,KAAKM,GAAG;IAC3B;IAEAb,SAASc,eAAe,CAAC,eAAgBC,EAAU,EAAET,IAAI;QACxD,IAAI;YACH,MAAMC,OAAO,MAAMC,kBAAS,CAACC,OAAO,CAAC;gBAAEI,KAAKE;YAAG;YAC/C,OAAOT,KAAK,MAAMC;QACnB,EAAE,OAAOS,KAAK;YACb,OAAOV,KAAKU,KAAK;QAClB;IACD;AACD"}