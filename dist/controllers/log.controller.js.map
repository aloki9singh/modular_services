{"version":3,"sources":["../../src/controllers/log.controller.ts"],"sourcesContent":["import { Request, Response } from \"express\";\r\nimport Log from \"../models/log.model\";\r\nimport URL from \"../models/url.model\";\r\nimport { calculateUniqueVisitors } from \"../services/calculateUniqueVisitors\";\r\n\r\nclass LogController {\r\n\tpublic async getURLAnalytics(req: Request, res: Response): Promise<void> {\r\n\t\ttry {\r\n\t\t\tconst { short_id } = req.params;\r\n\r\n\t\t\tconst urlDetails = await URL.findOne({ short_id });\r\n\r\n\t\t\tif (!urlDetails) {\r\n\t\t\t\tres.status(404).json({ error: \"URL not found\"});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Fetch access logs for this URL\r\n\t\t\tconst accessLogs = await Log.find({ url_id: urlDetails._id });\r\n\r\n\t\t\t// Assuming you have a function to calculate unique visitors\r\n\t\t\tconst uniqueVisitors = calculateUniqueVisitors(accessLogs);\r\n\r\n\t\t\tconst analyticsData = {\r\n\t\t\t\toriginal_url: urlDetails.original_url,\r\n\t\t\t\tshort_id: urlDetails.short_id,\r\n\t\t\t\texpiration_date: urlDetails.expiration_date,\r\n\t\t\t\tstarting_date: urlDetails.starting_date,\r\n\t\t\t\ttitle: urlDetails.title,\r\n\t\t\t\tdescription: urlDetails.description,\r\n\t\t\t\tstatus: urlDetails.status,\r\n\t\t\t\tshort_url: urlDetails.short_url,\r\n\t\t\t\tstats: {\r\n\t\t\t\t\ttotal_visitors: accessLogs.length,\r\n\t\t\t\t\tunique_visitors: uniqueVisitors,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\tres.json({\r\n\t\t\t\turl_details: analyticsData,\r\n\t\t\t});\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(error);\r\n\t\t\tres.status(500).json({ error: \"Internal Server Error\" });\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async getAllVisitors(req: Request, res: Response): Promise<void> {\r\n\t\ttry {\r\n\t\t\tconst { short_id } = req.params;\r\n\t\t\tconst page = parseInt(req.query.page as string) || 1;\r\n\t\t\tconst limit = 6; // Number of visitors per page\r\n\r\n\t\t\tconst urlDetails = await URL.findOne({ short_id });\r\n\r\n\t\t\tif (!urlDetails) {\r\n\t\t\t\tres.status(404).json({ error: \"URL not found\" });\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst skip = (page - 1) * limit;\r\n\r\n\t\t\tconst accessLogs = await Log.find({ url_id: urlDetails._id })\r\n\t\t\t\t.skip(skip)\r\n\t\t\t\t.limit(limit);\r\n\t\t\tres.json(accessLogs);\r\n\t\t\t\r\n\t\t\treturn;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(error);\r\n\t\t\tres.status(500).json({ error: \"Internal Server Error\" });\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default LogController;\r\n"],"names":["LogController","getURLAnalytics","req","res","short_id","params","urlDetails","URL","findOne","status","json","error","accessLogs","Log","find","url_id","_id","uniqueVisitors","calculateUniqueVisitors","analyticsData","original_url","expiration_date","starting_date","title","description","short_url","stats","total_visitors","length","unique_visitors","url_details","console","getAllVisitors","page","parseInt","query","limit","skip"],"mappings":";;;;+BA2EA;;;eAAA;;;mDA1EgB;mDACA;yCACwB;;;;;;AAExC,IAAA,AAAMA,gBAAN,MAAMA;IACL,MAAaC,gBAAgBC,GAAY,EAAEC,GAAa,EAAiB;QACxE,IAAI;YACH,MAAM,EAAEC,QAAQ,EAAE,GAAGF,IAAIG,MAAM;YAE/B,MAAMC,aAAa,MAAMC,iBAAG,CAACC,OAAO,CAAC;gBAAEJ;YAAS;YAEhD,IAAI,CAACE,YAAY;gBAChBH,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEC,OAAO;gBAAe;gBAC7C;YACD;YAGA,MAAMC,aAAa,MAAMC,iBAAG,CAACC,IAAI,CAAC;gBAAEC,QAAQT,WAAWU,GAAG;YAAC;YAG3D,MAAMC,iBAAiBC,IAAAA,gDAAuB,EAACN;YAE/C,MAAMO,gBAAgB;gBACrBC,cAAcd,WAAWc,YAAY;gBACrChB,UAAUE,WAAWF,QAAQ;gBAC7BiB,iBAAiBf,WAAWe,eAAe;gBAC3CC,eAAehB,WAAWgB,aAAa;gBACvCC,OAAOjB,WAAWiB,KAAK;gBACvBC,aAAalB,WAAWkB,WAAW;gBACnCf,QAAQH,WAAWG,MAAM;gBACzBgB,WAAWnB,WAAWmB,SAAS;gBAC/BC,OAAO;oBACNC,gBAAgBf,WAAWgB,MAAM;oBACjCC,iBAAiBZ;gBAClB;YACD;YAEAd,IAAIO,IAAI,CAAC;gBACRoB,aAAaX;YACd;QACD,EAAE,OAAOR,OAAO;YACfoB,QAAQpB,KAAK,CAACA;YACdR,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEC,OAAO;YAAwB;QACvD;IACD;IAEA,MAAaqB,eAAe9B,GAAY,EAAEC,GAAa,EAAiB;QACvE,IAAI;YACH,MAAM,EAAEC,QAAQ,EAAE,GAAGF,IAAIG,MAAM;YAC/B,MAAM4B,OAAOC,SAAShC,IAAIiC,KAAK,CAACF,IAAI,KAAe;YACnD,MAAMG,QAAQ;YAEd,MAAM9B,aAAa,MAAMC,iBAAG,CAACC,OAAO,CAAC;gBAAEJ;YAAS;YAEhD,IAAI,CAACE,YAAY;gBAChBH,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEC,OAAO;gBAAgB;gBAC9C;YACD;YAEA,MAAM0B,OAAO,AAACJ,CAAAA,OAAO,CAAA,IAAKG;YAE1B,MAAMxB,aAAa,MAAMC,iBAAG,CAACC,IAAI,CAAC;gBAAEC,QAAQT,WAAWU,GAAG;YAAC,GACzDqB,IAAI,CAACA,MACLD,KAAK,CAACA;YACRjC,IAAIO,IAAI,CAACE;YAET;QACD,EAAE,OAAOD,OAAO;YACfoB,QAAQpB,KAAK,CAACA;YACdR,IAAIM,MAAM,CAAC,KAAKC,IAAI,CAAC;gBAAEC,OAAO;YAAwB;QACvD;IACD;AACD;MAEA,WAAeX"}