{"version":3,"sources":["../src/app.ts"],"sourcesContent":["import express from 'express';\r\nimport cors from 'cors';\r\nimport hpp from 'hpp';\r\nimport helmet from 'helmet';\r\nimport compression from 'compression';\r\nimport { connect, set } from 'mongoose';\r\nimport env from './configs/env';\r\nimport { Routes } from './interfaces/routes.interface';\r\nimport session from 'express-session';\r\nimport passport from 'passport';\r\nimport ConnectMongoDBSession from 'connect-mongodb-session';\r\nimport passportConfig from './configs/passport';\r\nimport morgan from \"morgan\";\r\n\r\nconst MongoDBSession = ConnectMongoDBSession(session);\r\npassportConfig(passport);\r\n\r\nclass App {\r\n\tpublic app: express.Application;\r\n\tpublic env: string;\r\n\tpublic port: string | number;\r\n\tprivate store: ConnectMongoDBSession.MongoDBStore;\r\n\r\n\tconstructor(routes: Routes[]) {\r\n\t\tthis.app = express();\r\n\t\tthis.env = env.NODE_ENV || 'development';\r\n\t\tthis.port = env.PORT || 3000;\r\n\t\tthis.store = new MongoDBSession({ uri: env.MONGODB_URI, collection: 'adminSessions' });\r\n\t\tthis.connectToDatabase();\r\n\t\tthis.initializeMiddlewares();\r\n\t\tthis.initializeRoutes(routes);\r\n\t}\r\n\r\n\tpublic listen() {\r\n\t\tthis.app.listen(this.port, () => {\r\n\t\t\tconsole.log(`App listening on the port ${this.port}`);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic getServer() {\r\n\t\treturn this.app;\r\n\t}\r\n\r\n\tprivate connectToDatabase() {\r\n\t\tif (this.env !== 'production') {\r\n\t\t\tset('debug', false);\r\n\t\t}\r\n\r\n\t\tconnect(env.MONGODB_URI)\r\n\t\t\t.then(() => {\r\n\t\t\t\tconsole.log('Connected to DB');\r\n\t\t\t})\r\n\t\t\t.catch(error => {\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t});\r\n\t}\r\n\r\n\tprivate initializeRoutes(routes: Routes[]) {\r\n\t\troutes.forEach(route => {\r\n\t\t\tthis.app.use('/', route.router);\r\n\t\t});\r\n\t}\r\n\tprivate initializeMiddlewares() {\r\n\t\tthis.setupCORS();\r\n\t\tthis.app.use(hpp());\r\n\t\tthis.app.use(helmet());\r\n\t\tthis.app.use(compression());\r\n\t\tthis.app.use(express.json({ limit: '1mb' }));\r\n\t\tthis.app.use(express.urlencoded({ extended: true }));\r\n\t\tthis.app.use(passport.initialize());\r\n\t\tthis.app.use(\r\n\t\t\tsession({\r\n\t\t\t\tsecret: env.SESSION_SECRET,\r\n\t\t\t\tresave: false,\r\n\t\t\t\tsaveUninitialized: false,\r\n\t\t\t\tstore: this.store,\r\n\t\t\t\tname: env.AUTH_COOKIE_NAME,\r\n\t\t\t\tcookie: {\r\n\t\t\t\t\tdomain: env.COOKIE_DOMAIN,\r\n\t\t\t\t\tmaxAge: 1000 * 60 * 60 * 24 * 30,\r\n\t\t\t\t\tsameSite: 'lax',\r\n\t\t\t\t\tsecure: this.env === 'production',\r\n\t\t\t\t\thttpOnly: true,\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t);\r\n\t\tthis.app.use(passport.session());\r\n\t\tthis.app.use(morgan('dev'));\r\n\t}\r\n\tprivate setupCORS() {\r\n\t\tconst origins: boolean | string | RegExp | (boolean | string | RegExp)[] = [];\r\n\t\tif (['development'].includes(env.NODE_ENV)) {\r\n\t\t\torigins.push(/localhost:/);\r\n\t\t}\r\n\t\tconst corsOrigins = env.CORS_ORIGINS.split(',');\r\n\t\tif (corsOrigins.length > 0) {\r\n\t\t\torigins.push(\r\n\t\t\t\t...corsOrigins.map(corsOrigin => {\r\n\t\t\t\t\treturn corsOrigin.trim();\r\n\t\t\t\t}),\r\n\t\t\t);\r\n\t\t}\r\n\t\tthis.app.use(\r\n\t\t\tcors({\r\n\t\t\t\torigin: origins,\r\n\t\t\t\tcredentials: true,\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default App;\r\n"],"names":["MongoDBSession","ConnectMongoDBSession","session","passportConfig","passport","App","listen","app","port","console","log","getServer","connectToDatabase","env","set","connect","MONGODB_URI","then","catch","error","initializeRoutes","routes","forEach","route","use","router","initializeMiddlewares","setupCORS","hpp","helmet","compression","express","json","limit","urlencoded","extended","initialize","secret","SESSION_SECRET","resave","saveUninitialized","store","name","AUTH_COOKIE_NAME","cookie","domain","COOKIE_DOMAIN","maxAge","sameSite","secure","httpOnly","morgan","origins","includes","NODE_ENV","push","corsOrigins","CORS_ORIGINS","split","length","map","corsOrigin","trim","cors","origin","credentials","constructor","PORT","uri","collection"],"mappings":"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"}